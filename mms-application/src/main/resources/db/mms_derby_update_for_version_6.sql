-- Autogenerated: do not edit this file

UPDATE MMS_GLOBAL_CONFIGURATION SET CODE = '7' WHERE NAME = 'GLOBAL_VERSION';

CREATE TABLE MMS_SM_CONFIGURATION (
	SM_ID INT NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	SM_NAME VARCHAR(50) NOT NULL DEFAULT 'default',
	SM_TUNNEL_TYPE INT NOT NULL,
	SM_ACCESS_NUMBER BIGINT,
	COMPONY_NAME VARCHAR(200),
	APPLICATION_ID INT NOT NULL,
	APPLICATION_NAME VARCHAR(20),
	APPLICATION_PASSWORD VARCHAR(50) NOT NULL,
	EXTEND_CODE VARCHAR(10),
	SERVICE_ADDRESS VARCHAR(500) NOT NULL,
	SERVICE_TYPE CHAR(1) NOT NULL DEFAULT 'W',
	LIMITATION_CYCLE INT NOT NULL DEFAULT 0,
	LIMITATION_COUNT INT NOT NULL DEFAULT 0,
	STATUS CHAR(1) NOT NULL DEFAULT 'Y',
	CREATE_TIME TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	UPDATE_TIME TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

ALTER TABLE MMS_SCHEDULE DROP CONSTRAINT MMS_SCHEDULE_MS_FR;
RENAME TABLE MMS_MAIL_SERVER_CONFIGURATION TO MMS_MS_CONFIGURATION;
RENAME TABLE MMS_MAIL_JOB TO MMS_SCHEDULE_JOB;

ALTER TABLE MMS_SCHEDULE ADD CONSTRAINT MMS_SCHEDULE_MS_FR FOREIGN KEY (MS_ID) REFERENCES MMS_MS_CONFIGURATION;
ALTER TABLE MMS_SCHEDULE ADD COLUMN SM_ID INT CONSTRAINT MMS_SCHEDULE_SM_FR REFERENCES MMS_SM_CONFIGURATION;
ALTER TABLE MMS_SCHEDULE_JOB DROP COLUMN MS_ID;
ALTER TABLE MMS_SCHEDULE_JOB DROP COLUMN DS_ID;
ALTER TABLE MMS_SCHEDULE_JOB ADD COLUMN GATEWAY_ID VARCHAR(36);

ALTER TABLE MMS_SCHEDULE_JOB ADD COLUMN MESSAGE_ID VARCHAR(30) NOT NULL DEFAULT '';
UPDATE MMS_SCHEDULE_JOB AS JOB SET JOB.MESSAGE_ID = (SELECT TRIM(CAST(SCHEDULE.SEQ AS CHAR(30))) FROM MMS_SCHEDULE_JOB AS SCHEDULE WHERE SCHEDULE.JOB_ID = JOB.JOB_ID);
ALTER TABLE MMS_SCHEDULE_JOB DROP COLUMN SEQ;
RENAME COLUMN MMS_SCHEDULE_JOB.MESSAGE_ID TO SEQ;

ALTER TABLE MMS_SCHEDULE_JOB ADD COLUMN NAME VARCHAR(20);

RENAME TABLE MMS_MAIL_SERVER_TEMPLATE TO MMS_MS_TEMPLATE;
RENAME COLUMN MMS_DS_CONFIGURATION.ACTIVE TO STATUS;


INSERT INTO MMS_SCHEDULE (DISPLAY_NAME, JOB_NAME, ACTION_TYPE, ATTACHMENT_AS_CONTENT, CRON_EXPRESSION, DESCRIPTION, STATUS) VALUES ('短信任务扫描程序', 'ACTION_SM_SCAN', 9, TRUE, '0/10 * * * * ? *', '自动扫描短信发送任务','E');
INSERT INTO MMS_SCHEDULE (DISPLAY_NAME, JOB_NAME, ACTION_TYPE, URL, DESCRIPTION, STATUS) VALUES ('员工历史信息追溯', 'AUTO_PER_DOC_EXEC', 4, 'AUTO_PER_DOC_EXEC', '此自动任务计划的每次执行都将根据当前系统日期生成员工历史信息，不需要在安全模块中手动设置日期','E');
INSERT INTO MMS_GLOBAL_CONFIGURATION (NAME, VAL, TITLE, ACTIVE, DESCRIPTION) VALUES ('SCHEDULE_ACTION_TYPE',9,'短信任务扫描程序','G','自动扫描短信发送任务程序');


INSERT INTO MMS_GLOBAL_CONFIGURATION (NAME, VAL, TITLE) VALUES ('SHORT_MESSAGE_TUNNEL',1,'OpenMAS');

ALTER TABLE MMS_DS_CONFIGURATION ADD COLUMN UPDATE_TIME TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP;

UPDATE MMS_SCHEDULE SET JOB_NAME = 'ACTION_DO_BATCH_JOB', DISPLAY_NAME = '批量任务处理程序', DESCRIPTION = '批量任务处理程序，包括批量发送邮件和短信' WHERE JOB_NAME = 'ACTION_MAIL_SENDER';
UPDATE MMS_GLOBAL_CONFIGURATION SET TITLE = '批量任务处理程序', DESCRIPTION = '批量任务处理程序，包括批量发送邮件和短信' WHERE NAME = 'SCHEDULE_ACTION_TYPE' AND VAL = 6;

RENAME COLUMN MMS_MS_CONFIGURATION.SERVER_NAME TO MS_NAME;
ALTER TABLE MMS_SCHEDULE_JOB ALTER COLUMN SUBJECT NULL;

UPDATE MMS_SCHEDULE SET DISPLAY_NAME = '批量失败任务重置', JOB_NAME = 'ACTION_FAILD_BATCHJOB_RERESET', DESCRIPTION = '对于十分钟内执行失败的任务尝试重置' WHERE JOB_NAME = 'ACTION_MAIL_RESENDER' AND ACTION_TYPE = 6;
UPDATE MMS_GLOBAL_CONFIGURATION SET TITLE = '批量失败任务重置', DESCRIPTION = '对于十分钟内执行失败的任务尝试重置' WHERE NAME = 'SCHEDULE_ACTION_TYPE' AND VAL = 3;

INSERT INTO MMS_SCHEDULE (DISPLAY_NAME, JOB_NAME, ACTION_TYPE, CRON_EXPRESSION, DESCRIPTION, STATUS) VALUES ('守护服务监控程序', 'ACTION_DAEMON_MONITOR', 10, '0 0/1 * * * ? *', '监控守护服务的状态', 'I');
INSERT INTO MMS_GLOBAL_CONFIGURATION (NAME, VAL, TITLE, ACTIVE, DESCRIPTION) VALUES ('SCHEDULE_ACTION_TYPE',10,'守护服务监控程序','S','监控守护服务的状态');


